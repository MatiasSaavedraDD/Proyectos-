<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto ED - Lista de Tareas Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
        .card { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); }
        .completed { text-decoration: line-through; color: #6b7280; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-3xl mx-auto">
        <!-- TÍTULO Y CABECERA -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-700">📋 Lista de Tareas (Web MVC)</h1>
            <p class="text-gray-600 mt-2">Implementación de Estructura de Datos: Lista Enlazada</p>
        </header>

        <!-- AÑADIR NUEVA TAREA (FORMULARIO) -->
        <div class="card bg-white p-6 rounded-xl mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Agregar Nueva Tarea</h2>
            <!-- El formulario llama a la ruta '/agregar' usando el método POST -->
            <form action="{{ url_for('agregar') }}" method="post" class="space-y-3">
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                    <input type="text" name="descripcion" placeholder="Escribe la descripción de la tarea..." required
                           class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-700">
                    <button type="submit"
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 ease-in-out">
                        Añadir Tarea
                    </button>
                </div>
                <textarea name="descripcion_detallada" placeholder="Detalles adicionales (opcional): ej. verduras, pan, queso..." 
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-700 resize-none"
                          rows="2"></textarea>
            </form>
        </div>

        <!-- LISTA DE TAREAS -->
        <div class="card bg-white p-6 rounded-xl">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Tareas Pendientes y Completadas</h2>
            
            {% if tareas %}
                <!-- Bucle para recorrer la lista de tareas enviada por el Controlador -->
                {% for tarea in tareas %}
                <div class="flex justify-between items-center p-3 my-2 border-b last:border-b-0
                            {% if tarea.estado == 'Completada' %} bg-green-50/70 {% else %} hover:bg-gray-50 {% endif %} rounded-md transition duration-150">
                    
                    <!-- Descripción de la Tarea -->
                    <div class="flex-1 mr-4">
                        <span class="text-lg font-medium
                                     {% if tarea.estado == 'Completada' %} completed {% endif %}">
                            {{ loop.index }}. {{ tarea.descripcion }}
                        </span>
                        {% if tarea.descripcion_detallada %}
                        <div class="text-sm text-gray-600 mt-1 bg-gray-50 p-2 rounded border-l-4 border-blue-200">
                            📝 {{ tarea.descripcion_detallada }}
                        </div>
                        {% endif %}
                        <div class="text-sm text-gray-500 mt-1">
                            📅 Creada: {{ tarea.fecha_creacion }}
                        </div>
                    </div>
                    
                    <!-- Estado -->
                    <span class="text-sm font-semibold p-1 px-3 rounded-full mr-4 w-28 text-center
                                 {% if tarea.estado == 'Completada' %} bg-green-200 text-green-800 {% else %} bg-yellow-200 text-yellow-800 {% endif %}">
                        {{ tarea.estado }}
                    </span>

                    <!-- ACCIONES -->
                    <div class="flex space-x-2">
                        <!-- Formulario para Completar -->
                        {% if tarea.estado != 'Completada' %}
                            <!-- Llamada a la ruta /completar con la descripción de la tarea -->
                            <form action="{{ url_for('completar', descripcion_tarea=tarea.descripcion) }}" method="post" class="inline">
                                <button type="submit" title="Marcar como Completada"
                                        class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg transition duration-150 ease-in-out">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.078 3.097 5.494-5.485z"/>
                                    </svg>
                                </button>
                            </form>
                        {% endif %}

                        <!-- Formulario para Eliminar -->
                        <!-- Llamada a la ruta /eliminar con la descripción de la tarea -->
                        <form action="{{ url_for('eliminar', descripcion_tarea=tarea.descripcion) }}" method="post" class="inline">
                            <button type="submit" title="Eliminar Tarea"
                                    class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg transition duration-150 ease-in-out">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-gray-500 text-center py-4">¡No hay tareas en la lista! Agrega una arriba.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>